#
# Install FFMPEG and any necessary libraries from source.
# Wish that ffmpeg was always up-to-date w/ everything in the
# world enabled... but no... bullshit reasons need apply.
#

- name: Clone x264
  git:
    accept_hostkey=yes
    force=yes
    dest={{ ansible_env.HOME }}/src/x264
    repo=git://git.videolan.org/x264

- name: Build x264
  command: "{{ item }}"
  args:
    chdir: "{{ ansible_env.HOME }}/src/x264"
  with_items:
  - ./configure --enable-static --enable-shared --enable-gpl
  - make -j 4
  - sudo make install

- name: Clone FFMPEG
  git:
    accept_hostkey=yes
    clone=yes
    dest={{ ansible_env.HOME }}/src/ffmpeg
    force=yes
    repo=git://source.ffmpeg.org/ffmpeg.git

#
# Disabled for now... crashes the shit out of my Pi after a few minutes
# regularly... segfaults, then the SD disk becomes unavailable. Currently 
# running processes generally stay alive until they try to hit the disk.
#
#- name: Build FFMPEG
#  command: "{{ item }}"
#  args:
#    chdir: "{{ ansible_env.HOME }}/src/ffmpeg"
#  with_items:
#  - ./configure --enable-libx264 --enable-gpl --enable-nonfree --arch=armel --target-os=linux
#  - make 
#  - sudo make install
